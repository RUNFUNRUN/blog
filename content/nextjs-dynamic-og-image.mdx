---
title: Next.js App Routerã§å‹•çš„ã«OpenGraphã®ç”»åƒã‚’ç”Ÿæˆã™ã‚‹
description: æœ¬ãƒ–ãƒ­ã‚°ã§ã€å‹•çš„ã«ç”»åƒã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã®æ–¹æ³•ã‚’å…±æœ‰ã—ã¾ã™ã€‚
date: 2024-02-28
tags: ['Next.js', 'SEO']
---

## ã¯ã˜ã‚ã«

OpenGraphã¯ã€Twitterã‚„Discordã€Slackãªã©ã®SNSã§ãƒªãƒ³ã‚¯ã‚’å…±æœ‰ã—ãŸéš›ã«ã€
ãƒªãƒ³ã‚¯å…ˆã®ã‚µã‚¤ãƒˆã®æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã™ã€‚
Qiitaã‚„Zennãªã©ã¯ãƒšãƒ¼ã‚¸ã®ã‚¿ã‚¤ãƒˆãƒ«ãŒç”»åƒã«å…¥ã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ãŒã€
ä»Šå›ã¯ãã‚Œã¨åŒã˜ã‚ˆã†ãªç”»åƒã‚’Next.jsã§å‹•çš„ã«ç”Ÿæˆã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## ã‚„ã‚Šæ–¹

ã‚„ã‚Šæ–¹ã¨ã—ã¦ã¯ã€æ™®é€šã®ãƒ«ãƒ¼ãƒˆã§ç”Ÿæˆã™ã‚‹æ–¹æ³•ã¨ã€apiãƒ«ãƒ¼ãƒˆã‚’ä½¿ã†æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

ä»Šå›ã¯apiãƒ«ãƒ¼ãƒˆã‚’ä½¿ã†æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚
æ™®é€šã®ãƒ«ãƒ¼ãƒˆã§ç”Ÿæˆã™ã‚‹æ–¹æ³•ã¯ã€
[Next.jså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã“ã¡ã‚‰](https://nextjs.org/docs/app/api-reference/file-conventions/metadata/opengraph-image)
ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

apiãƒ«ãƒ¼ãƒˆã‚’ä½¿ã†å ´åˆã¯Next.jså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ãªãã€Vercelã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ›¸ã„ã¦ã‚ã‚Šã¾ã—ãŸã€‚
ä»Šå›ã¯[ã“ã¡ã‚‰](https://vercel.com/docs/functions/og-image-generation)ã‚’ã‚‚ã¨ã«é€²ã‚ã¦ã„ãã¾ã™ã€‚

### apiå´ã®å®Ÿè£…

ã¾ãšã¯ã€ç”»åƒç”Ÿæˆã™ã‚‹apiãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
`src`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½¿ã£ã¦ã„ãªã„æ–¹ã¯ã€èª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚

```bash
mkdir -p src/app/api/og
touch src/app/api/og/route.tsx
```

å…¬å¼ã«ã¯ã“ã®ã‚ˆã†ã«æ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚

```tsx
import { ImageResponse } from 'next/og';
// App router includes @vercel/og.
// No need to install it.

export const runtime = 'edge';

export async function GET() {
  return new ImageResponse(
    (
      <div
        style={{
          fontSize: 40,
          color: 'black',
          background: 'white',
          width: '100%',
          height: '100%',
          padding: '50px 200px',
          textAlign: 'center',
          justifyContent: 'center',
          alignItems: 'center',
        }}
      >
        ğŸ‘‹ Hello
      </div>
    ),
    {
      width: 1200,
      height: 630,
    },
  );
}
```

ã‚ã£ã¡ã‚ƒç°¡å˜ã§ã™ã­ã€‚

ãŸã ã€edge runtimeãªã®ã§ã€ã“ã“ã§ã¯Nodeã®APIã¯ä½¿ãˆãªã„ã“ã¨ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚
ã“ã‚Œã¯apiãƒ«ãƒ¼ãƒˆã‚’ä½¿ã‚ãªãã¦ã‚‚åŒã˜ã§ã™ã€‚

<Callout title='edge runtimeã§å‹•ã‹ãªããªã£ã¦ã„ã¾ã™ã€‚' type='warn'>
  2025/04/20æ™‚ç‚¹nextjs 15.3.1 Vercelã®ç’°å¢ƒã§ã§edge runtimeã ã¨é€†ã«å‹•ã‹ãªããªã£ã¦ã„ã¾ã™ã€‚
  ã“ã®è¨˜äº‹ã§ã¯ä¸€æ—¦edge runtimeã®è¨­å®šã¯æ®‹ã—ã¦ãŠãã¾ã™ãŒã€æ­£å¸¸ã«å‹•ä½œã—ãªã„å ´åˆã¯æ¶ˆã—ã¦ã¿ã¦ãã ã•ã„ã€‚
</Callout>

è‡ªåˆ†ã®å ´åˆã¯searchParamsã«æ–‡å­—ã®æƒ…å ±ã‚’æ¸¡ã—ã¦å®Ÿè£…ã—ã¾ã—ãŸã€‚

ã¾ãŸã€ç”»åƒã«ã¤ã„ã¦ã¯VercelãŒãƒ—ãƒ¬ã‚¤ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚’æä¾›ã—ã¦ã„ã‚‹ã®ã§ã€
è‡ªåˆ†ã¯ãã‚Œã‚’ä½¿ã£ã¦ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã—ã¾ã—ãŸã€‚

[https://og-playground.vercel.app/](https://og-playground.vercel.app/)

ãŸã ã€ãƒ•ã‚©ãƒ³ãƒˆã¯ç•°ãªã‚‹ã®ã§ã€æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚
ã‚ã¨ã‚µã‚¤ã‚ºã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ã¨800x400ãªã®ã§ã€å„è‡ªå¤‰æ›´ã—ã¦ãã ã•ã„ã€‚
è‡ªåˆ†ã¯1200x630ã«ã—ã¾ã—ãŸã€‚

è‡ªåˆ†ã®å®Ÿè£…ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚

```tsx title="src/app/api/og/route.tsx"
import { ImageResponse } from 'next/og';
import { NextRequest } from 'next/server';

export const runtime = 'edge';

const notoSansJP = fetch(
  new URL('./NotoSansJP-Bold.ttf', process.env.NEXT_PUBLIC_SITE_URL ?? 'http://localhost:3000'),
).then((res) => res.arrayBuffer());

export const GET = async (req: NextRequest) => {
  const searchParams = req.nextUrl.searchParams;
  const title = searchParams.get('title');
  const description = searchParams.get('description');

  if (title === null && description === null) {
    return new ImageResponse(
      (
        <div
          style={{
            display: 'flex',
            height: '100%',
            width: '100%',
            backgroundColor: '#ffffff',
            background: 'linear-gradient(to bottom, blue, cyan)',
          }}
        >
          <div
            style={{
              backgroundColor: '#000000',
              color: '#ffffff',
              fontWeight: 600,
              display: 'flex',
              flexDirection: 'column',
              marginTop: '2rem',
              marginBottom: '2rem',
              marginLeft: '2rem',
              marginRight: '2rem',
              flexGrow: '1',
              borderRadius: '1rem',
            }}
          >
            <p
              style={{
                fontSize: 100,
                marginTop: 'auto',
                marginBottom: 'auto',
                marginLeft: 'auto',
                marginRight: 'auto',
              }}
            >
              RUNFUNRUN.dev
            </p>
          </div>
        </div>
      ),
      {
        width: 1200,
        height: 630,
        fonts: [{ name: 'Inter', data: await notoSansJP }],
      },
    );
  }

  return new ImageResponse(
    (
      <div
        style={{
          display: 'flex',
          height: '100%',
          width: '100%',
          backgroundColor: '#ffffff',
          background: 'linear-gradient(to bottom, blue, cyan)',
        }}
      >
        <div
          style={{
            backgroundColor: '#000000',
            color: '#ffffff',
            fontWeight: 600,
            display: 'flex',
            flexDirection: 'column',
            marginTop: '2rem',
            marginBottom: '2rem',
            marginLeft: '2rem',
            marginRight: '2rem',
            flexGrow: '1',
            borderRadius: '1rem',
          }}
        >
          <p
            style={{
              fontSize: 50,
              marginTop: '2rem',
              marginBottom: 'auto',
              marginLeft: '4rem',
              marginRight: '4rem',
            }}
          >
            RUNFUNRUN.dev
          </p>
          <div
            style={{
              fontSize: 70,
              marginLeft: '4rem',
              marginRight: '4rem',
            }}
          >
            {title}
          </div>
          <div
            style={{
              fontSize: 30,
              marginTop: 'auto',
              marginBottom: '2rem',
              marginLeft: '4rem',
              marginRight: '4rem',
            }}
          >
            {description}
          </div>
        </div>
      </div>
    ),
    {
      width: 1200,
      height: 630,
      fonts: [{ name: 'Inter', data: await notoSansJP }],
    },
  );
};
```

`public`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ã„ã¦ã€ãã‚Œã‚’fetchã—ã¦ã„ã¾ã™ã€‚

apiãƒ«ãƒ¼ãƒˆã®ä¸­ã«ãƒ•ã‚©ãƒ³ãƒˆã‚’ç½®ãã“ã¨ã‚‚å¯èƒ½ã§ã™ãŒã€
Vercelã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹éš›ã«ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚

```text
Error: The Edge Function "api/og" size is 3.93 MB and your plan size limit is 1 MB.
       Learn More: https://vercel.link/edge-function-size
```

ã‚µã‚¤ã‚ºãŒå¤§ãã™ããŸã¿ãŸã„ã§ã™ã€‚
`public`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç½®ãã“ã¨ã§è§£æ±ºã§ãã¾ã—ãŸã€‚

ãƒ•ã‚©ãƒ³ãƒˆã¯æ—¥æœ¬èªå¯¾å¿œã—ã¦ãŸã‚‰ãªã‚“ã§ã‚‚ã„ã„ã§ã™ã€‚
è‡ªåˆ†ã¯Google Fontsã‹ã‚‰Noto Sans JPã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€
ãã®ä¸­ã®`NotoSansJP-Bold.ttf`ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

[ã“ã¡ã‚‰](https://fonts.google.com/noto/specimen/Noto+Sans+JP?subset=japanese&noto.script=Hira)
ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚

### å‘¼ã³å‡ºã—å´ã®å®Ÿè£…

ä»Šå›ã¯ãƒ›ãƒ¼ãƒ ã¨å„è¨˜äº‹ã®2ç¨®é¡ã‹ã‚‰å‘¼ã³å‡ºãã†ã¨æ€ã„ã¾ã™ã€‚

### ãƒ›ãƒ¼ãƒ 

ã¾ãšã¯ãƒ›ãƒ¼ãƒ ã§ã™ã€‚

```tsx title="src/app/layout.tsx"
import type { Metadata } from 'next';
...

export const metadata: Metadata = {
  metadataBase: new URL(process.env.NEXT_PUBLIC_SITE_URL ?? 'http://localhost:3000'),
  title: 'RUNFUNRUN.dev',
  description: 'This is my tech blog.',
  openGraph: {
    title: 'RUNFUNRUN.dev',
    description: 'This is my tech blog.',
    images: '/api/og',
    url: '/',
  },
  twitter: {
    title: 'RUNFUNRUN.dev',
    description: 'This is my tech blog.',
    images: '/api/og',
  },
};

...
```

searchParamsã‚’è¨­å®šã—ã¦ãªã„ã®ã§ã€å…ˆã»ã©å®Ÿè£…ã—ãŸã‚ˆã†ã«ã‚¿ã‚¤ãƒˆãƒ«ãŒ
ãƒ‰ãƒ‡ã‚«ããªã‚Šã¾ã™ã€‚

{/*Do not use Markdownâ€™s built-in image syntax when working with images using relative paths.*/}
import { ImageZoom } from 'fumadocs-ui/components/image-zoom';

<LinkPreview url='https://www.runfunrun.dev' />

### è¨˜äº‹ãƒšãƒ¼ã‚¸

è¨˜äº‹ã®æ–¹ã¯`page.tsx`ã®`generateMetadata`ã§è¨­å®šã—ã¾ã™ã€‚

`getPage`ã¨`getPages`ã¯Fumadocsã®æ©Ÿèƒ½ã§ã€
mdxã®ãƒ‡ãƒ¼ã‚¿ã‚’å–ã£ã¦ãã¦ãã‚Œã‚‹é–¢æ•°ã§ã™ã€‚

Next.jsã®`Metadata`ã§ã¯`metadataBase`ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã€
ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å†…ã§ç›¸å¯¾ãƒ‘ã‚¹ã‚’ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚

```tsx title="src/app/posts/[[...slug]]/page.tsx"
import { getPage, getPages } from '@/app/source';
import type { Metadata } from 'next';
...

export const generateMetadata = ({ params }: { params: { slug?: string[] } }) => {
  const post = getPage(params.slug);

  if (post === undefined) return;

  const title = post.data.title;
  const description = post.data.description;
  const imageParams = new URLSearchParams();
  imageParams.set('title', title);
  imageParams.set('description', description ?? '');

  return {
    metadataBase: new URL(process.env.NEXT_PUBLIC_SITE_URL ?? 'http://localhost:3000'),
    title,
    description,
    openGraph: {
      title,
      description,
      images: `/api/og?${imageParams}`,
      url: post.url,
    },
    twitter: {
      title,
      description,
      images: `/api/og?${imageParams}`,
    },
  } satisfies Metadata;
};

...
```

è¨˜äº‹ã®ãƒšãƒ¼ã‚¸ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚

<LinkPreview url='https://www.runfunrun.dev/posts/first-blog' />

## æœ€å¾Œã«

çµæ§‹ç°¡å˜ã«å®Ÿè£…ã§ãã¾ã—ãŸã€‚
Next.jsã¯æœ¬å½“ã«ä¾¿åˆ©ã§ã™ã€‚

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å…¨éƒ¨è¦‹ãŸã„æ–¹ã¯ã€æœ¬ãƒ–ãƒ­ã‚°å³ä¸Šã‹ã‚‰GitHubãƒªãƒã‚¸ãƒˆãƒªã‚’
è¦‹ã¦ã¿ã¦ãã ã•ã„ã€‚

ã§ã¯ã¾ãŸã€‚
